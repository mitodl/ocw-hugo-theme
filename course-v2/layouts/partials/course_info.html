{{ $courseData := .context.Site.Data.course }}
{{ $inPanel := .inPanel }}
<div class="course-info">
  <div class="course-detail-title {{ if $inPanel }}bg-light-gray{{ end }}">
    <div class="d-flex">
      <div class="{{ if $inPanel }}py-2 pl-3{{ end }}">
      Course Info
      </div>
      {{ if $inPanel }}
      <div class="close-course-info large-and-above-only" onclick="desktopCourseInfoToggle()">
          <img class="toggle navbar-toggle offcanvas-toggle" src="/images/close_small.svg" alt="">
      </div>
      {{ end }}
    </div>
  </div>
  <div id="course-info" class="position-relative {{ if $inPanel }}px-3 mt-4{{ end }}">
    <div class="row">
      <div class="col-12 {{ if not $inPanel }}col-sm-6{{ end }}">
        {{ with $courseData.instructors.content }}
          <div class="">
            {{ $instructors := partial "get_instructors.html" . }}
            <div class="{{ if $inPanel }}panel-course-info-title {{ else }} text-muted {{ end }}">
              {{ if eq (len $instructors) 1 }}Instructor{{ else }}Instructors{{ end }}
            </div>
            <div class="course-info-content {{ if $inPanel }}panel-course-info-text{{ end }}">
              {{ partial "partial_collapse_list.html" (dict "list" $instructors "id" "instructors" "key" "title" "klass" "course-info-instructor" "showCollapse" $inPanel) }}
            </div>
          </div>
        {{ end }}

        {{ with $courseData.department_numbers }}
          <div class="mt-4">
            {{ $departments := partial "get_departments.html" . }}
            <div class="{{ if $inPanel }}panel-course-info-title {{ else }} text-muted {{ end }}">
              Departments
            </div>
            <div class="course-info-content {{ if $inPanel }}panel-course-info-text{{ end }}">
              {{ partial "partial_collapse_list.html" (dict "list" $departments "id" "departments" "key" "title" "klass" "course-info-department" "useLinks" true) }}
            </div>
          </div>
        {{ end }}

        {{ if $inPanel }}
          <div class="mt-4">
            <div class="{{ if $inPanel }}panel-course-info-title {{ else }} text-muted {{ end }}">
              As Taught In
            </div>
            <div class="course-info-content {{ if $inPanel }}panel-course-info-text{{ end }}">
              {{ $courseData.term }} {{ if isset $courseData "year" }}{{ $courseData.year }}{{ end }}
            </div>
          </div>

          <div class="mt-4">
            <div class="{{ if $inPanel }}panel-course-info-title {{ else }} text-muted {{ end }}">
              Level
            </div>
            <div class="course-info-content {{ if $inPanel }}panel-course-info-text{{ end }}">
              {{ if eq (printf "%T" $courseData.level) "string" }}
                {{ $levelSearchUrl := partial "get_search_url.html" (dict "key" "level" "value" $courseData.level) }}
                <a href="{{ $levelSearchUrl }}" class="course-info-level">
                  {{ $courseData.level }}
                </a>
              {{ else }}
                {{ range $courseData.level }}
                  {{ $levelSearchUrl := partial "get_search_url.html" (dict "key" "level" "value" .) }}
                  <a href="{{ $levelSearchUrl }}" class="course-info-level">
                    {{ . }}
                  </a><br />
                {{ end }}
              {{ end }}
            </div>
          </div>
        {{ end }}
      </div>
      
      {{ if not $inPanel }}
      <div class="col-12 col-sm-6">
        <div class="mt-4 mt-sm-0">
          <div class="text-muted">
            Topics
          </div>
          <div class="course-info-content">
            {{ partial "topics_oneline.html" . }}
          </div>
        </div>
      </div>
      {{ end }}
    </div>
  </div>
</div>

<script>
// todo: move this function to js file.
// currently having some issues while using this function from js file
function desktopCourseInfoToggle(){
  const desktopCourseInfo = document.getElementById("desktop-course-info")
  const showCourseInfoBtn = document.getElementById("show-course-info")
  const mainCourseSection = document.getElementById("main-course-section")
  desktopCourseInfo.classList.toggle("d-none")
  showCourseInfoBtn.classList.toggle("d-none")
  mainCourseSection.classList.toggle("col-lg-9")
  mainCourseSection.classList.toggle("col-md-12")
}
</script>