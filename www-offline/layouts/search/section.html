{{ define "main" }}
{{- $studioBaseUrl := partial "ocw_studio_base_url.html" -}}
{{- $apiBearerToken := getenv "API_BEARER_TOKEN" | default "" -}}
{{- $queryString := querify "version" "live" -}}
<script>
window.addEventListener("load", (event) => {
  window.LunrJSON = [
  {{- if and $studioBaseUrl (ne $apiBearerToken "") -}}
    {{- $apiUrl := printf "%v/api/publish?%v" (strings.TrimSuffix "/" $studioBaseUrl) $queryString -}}
    {{- $apiHeaders := dict "headers" (dict "Authorization" (printf "Bearer %v" $apiBearerToken)) -}}
    {{- $coursesJson := resources.GetRemote $apiUrl $apiHeaders -}}
    {{- with transform.Unmarshal $coursesJson -}}
      {{- $sites := .sites -}}
      {{- if $sites -}}
        {{ range $index, $courseItem := $sites }}
          {{- $path := strings.TrimPrefix "/" (strings.TrimSuffix "/" $courseItem.base_url) -}}
          {{- if not (eq $path "") -}}
    {
      "id": "{{ $path }}",
      "name": "{{ $courseItem.name }}",
      "short_id": "{{ $courseItem.short_id }}"
    },
          {{- end -}}
        {{ end }}
      {{- end -}}
    {{- end -}}
  {{- end -}}
  ]
  window.LunrIndex = window.lunr(function() {
    this.ref("short_id")
    this.field("name")

    window.LunrJSON.forEach(function (doc) {
      this.add(doc)
    }, this)
  })
})
</script>
<div class="search-wrapper">
  {{ block "header" . }}
  {{ $renderSearchIcon := index .Params "renderSearchIcon" | default true }}
  {{ partialCached "header" . $renderSearchIcon }}
  {{ end }}
  <div class="container-fluid">
    <main>
      <div class="container-fluid p-0">
        <div class="row m-0">
          <div id="search-page-offline" class="w-100"></div>
        </div>
      </div>
    </main>
  </div>
</div>
{{ end }}
