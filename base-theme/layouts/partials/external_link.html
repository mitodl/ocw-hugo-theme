{{- $text := default .title .text | htmlEscape | page.RenderString -}}
{{- $isImage := default false .is_image -}}
{{- $href := default "" .external_url -}}
{{- $isBroken := default false .is_broken -}}
{{- $backupUrl := default "" .backup_url -}}

{{- if and $isBroken $backupUrl -}}
  {{- $href = $backupUrl -}}
{{- end -}}

{{- if $isImage -}}
  <img src="{{- $href -}}" alt="{{- $text -}}" />
{{- else -}}
  {{ partial "link" (dict "href" $href "text" $text "class" .class) }}
{{- end -}}
