{{/*
  TODO: With the change of moving course sites to use relative URLs wherever possible, BaseURL is not set to /courses/course_id anymore

  We need a way to get this information during the build besides site.BaseURL, because if it is set it throws off relative_path_to_root.html
  Another option is to continue to pass --baseURL and modify relative_path_to_root to optionally ignore it, allowing you to get the relative path
  to both the currently rendering site's root and / or the path all the way back to the root including site.BaseURL
*/}}
{{- $sitemapDomain := partial "sitemap_domain.html" -}}
{{- $disallowedUrls := slice "categories/" "tags/" "pages/" "resources/" "tags/" "collections/" "course-lists/" "instructors/" "promos/" "resource_collections/" -}}
{{ printf "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?>" | safeHTML }}
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
  xmlns:xhtml="http://www.w3.org/1999/xhtml">
  {{ range .Data.Pages }}
    {{- if and .RelPermalink (not .Params.headless) (not (eq .RelPermalink "sitemap.xml")) -}}
      {{- $path := strings.TrimPrefix "/" (partial "absolute_url.html" .RelPermalink) -}}
      {{- if not (in $disallowedUrls $path) -}}
        {{- $url := printf "https://%v/%v" $sitemapDomain $path -}}
  <url>
    <loc>{{ $url }}</loc>{{ if not .Lastmod.IsZero }}
    <lastmod>{{ safeHTML ( .Lastmod.Format "2006-01-02T15:04:05-07:00" ) }}</lastmod>{{ end }}{{ with .Sitemap.ChangeFreq }}
    <changefreq>{{ . }}</changefreq>{{ end }}{{ if ge .Sitemap.Priority 0.0 }}
    <priority>{{ .Sitemap.Priority }}</priority>{{ end }}{{ if .IsTranslated }}{{ range .Translations }}
    <xhtml:link
                rel="alternate"
                hreflang="{{ .Language.Lang }}"
                href="{{ $url }}"
                />{{ end }}
    <xhtml:link
                rel="alternate"
                hreflang="{{ .Language.Lang }}"
                href="{{ $url }}"
                />{{ end }}
  </url>
      {{- end -}}
    {{- end -}}
  {{ end }}
</urlset>