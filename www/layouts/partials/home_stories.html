{{- $stories := where .Site.RegularPages "Type" "==" "stories" -}}
{{- $storiesSection := .Site.GetPage "section" "stories" -}}
{{- $breakdowns := (dict "xs-sm" (dict "size" 1 "class" "d-flex d-md-none") "md" (dict "size" 2 "class" "d-none d-md-flex d-lg-none") "lg" (dict "size" 3 "class" "d-none d-lg-flex d-xl-none") "xl" (dict "size" 3 "class" "d-none d-xl-flex")) -}}
<div class="home-testimonials standard-width container mx-auto my-3">
  {{ range $breakpoint, $carouselInfo := $breakdowns }}
    {{ $itemsInCarousel := index $carouselInfo "size" }}
    {{ $breakpointVisibilityClass := index $carouselInfo "class" }}
    {{ $isMobile := (eq $itemsInCarousel 1) }}
    {{ $carouselId := (printf "testimonial-carousel-%v" $breakpoint) }}
    <div class="{{ $breakpointVisibilityClass }}">
      <div id="{{ $carouselId }}" class="carousel slide" data-interval="false" data-touch="true" data-ride="carousel">
        <div class="carousel-header d-flex flex-row justify-content-between font-weight-bold">
          <h2>OCW Stories</h2>
          {{ if gt (len $stories) 3 }}
            {{ partial "carousel_controls.html" $carouselId }}
          {{ end }}
        </div>
        <div class="carousel-inner">
          {{ range $index, $testimonial := $stories  }}
            {{ with $testimonial }}
              {{ $modulo := (mod $index $itemsInCarousel) }}
              {{ $group := (div $index $itemsInCarousel) }}
              {{ if eq $modulo 0 }}
              <div class="carousel-item row {{ if eq $group 0 }}active{{ end }} flex-nowrap justify-content-center" style="flex: nowrap">
                {{ end }}
                  <div style="padding:10px; flex: 1 1; margin-left: 10px;" class="item-wrapper">
                    <!-- <div class="item-wrapper w-100 d-flex justify-content-center"> -->
                      {{ partial "stories_card.html" $testimonial }}
                    <!-- </div> -->
                  </div>
                {{ if (or (eq $modulo (sub $itemsInCarousel 1)) (eq $index (sub (len $stories) 1))) }}
              </div>
              {{ end }}
            {{ end }}
          {{ end }}
        </div>
      </div>
    </div>
  {{ end }}
  <!-- <div class="d-flex py-4">
    <div class="ml-auto">
      <a class="view-all-link" href="{{ $storiesSection.RelPermalink }}">View All OCW Stories</a>
    </div>
  </div> -->
  <div class="d-flex justify-content-center my-4">
    <a href="#" class="btn px-4 py-3 text-decoration-none d-flex align-items-center" style="padding: 15px 20px; border-radius: 3px; border: 1px solid var(--Border-Grey, #DFE5EC); background: var(--white-mit-brand, #FFF); font-weight: 600; color:#03152D;">
      View All OCW Stories
      <img
        class=""
        src="{{ partial "get_asset_webpack_url.html" "images/ocw_stories_btn_arrow_right.svg" }}"
        alt=""
        style="margin-left:10px"
      />
    </a>
  </div>
</div>
